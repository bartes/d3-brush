// https://d3js.org/d3-brush/ v1.1.5 Copyright 2020 Mike Bostock
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection"),require("d3-dispatch"),require("d3-drag"),require("d3-interpolate"),require("d3-transition")):"function"==typeof define&&define.amd?define(["exports","d3-selection","d3-dispatch","d3-drag","d3-interpolate","d3-transition"],e):e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,n,r,i,s){"use strict";function a(t){return function(){return t}}function u(t,e,n){this.target=t,this.type=e,this.selection=n}function o(){e.event.stopImmediatePropagation()}function l(){e.event.preventDefault(),e.event.stopImmediatePropagation()}var c={name:"drag"},h={name:"space"},f={name:"handle"},d={name:"center"};function p(t){return[+t[0],+t[1]]}function v(t){return[p(t[0]),p(t[1])]}var y={name:"x",handles:["w","e"].map(k),input:function(t,e){return null==t?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},m={name:"y",handles:["n","s"].map(k),input:function(t,e){return null==t?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},b={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(k),input:function(t){return null==t?null:v(t)},output:function(t){return t}},w={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},g={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},x={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},M={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},_={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function k(t){return{type:t}}function z(){return!e.event.ctrlKey&&!e.event.button}function A(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function q(){return navigator.maxTouchPoints||"ontouchstart"in this}function E(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function K(t){var p,b=A,K=z,T=q,P=!0,V=n.dispatch("start","brush","end"),S=6;function j(n){var r=n.property("__brush",O).selectAll(".overlay").data([k("overlay")]);r.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",w.overlay).merge(r).each(function(){var t=E(this).extent;e.select(this).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1])}),n.selectAll(".selection").data([k("selection")]).enter().append("rect").attr("class","selection").attr("cursor",w.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var i=n.selectAll(".handle").data(t.handles,function(t){return t.type});i.exit().remove(),i.enter().append("rect").attr("class",function(t){return"handle handle--"+t.type}).attr("cursor",function(t){return w[t.type]}),n.each(B).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",I).filter(T).on("touchstart.brush",I).on("touchmove.brush",G).on("touchend.brush touchcancel.brush",N).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function B(){var t=e.select(this),n=E(this).selection;n?(t.selectAll(".selection").style("display",null).attr("x",n[0][0]).attr("y",n[0][1]).attr("width",n[1][0]-n[0][0]).attr("height",n[1][1]-n[0][1]),t.selectAll(".handle").style("display",null).attr("x",function(t){return"e"===t.type[t.type.length-1]?n[1][0]-S/2:n[0][0]-S/2}).attr("y",function(t){return"s"===t.type[0]?n[1][1]-S/2:n[0][1]-S/2}).attr("width",function(t){return"n"===t.type||"s"===t.type?n[1][0]-n[0][0]+S:S}).attr("height",function(t){return"e"===t.type||"w"===t.type?n[1][1]-n[0][1]+S:S})):t.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function C(t,e,n){return!n&&t.__brush.emitter||new D(t,e)}function D(t,e){this.that=t,this.args=e,this.state=t.__brush,this.active=0}function I(){if((!p||e.event.touches)&&K.apply(this,arguments)){var n,i,a,u,v,b,k,z,A,q,T,V,S=this,j=(e.event.desiredTarget||e.event.target).__data__.type,D="selection"===(P&&e.event.metaKey?j="overlay":j)?c:P&&e.event.altKey?d:f,I=t===m?null:M[j],G=t===y?null:_[j],N=E(S),O=N.extent,X=N.selection,Y=O[0][0],F=O[0][1],H=O[1][0],J=O[1][1],L=0,Q=0,R=I&&G&&P&&e.event.shiftKey,U=e.event.touches?(V=e.event.changedTouches[0].identifier,function(t){return e.touch(t,e.event.touches,V)}):e.mouse,W=U(S),Z=W,$=C(S,arguments,!0).beforestart();"overlay"===j?(X&&(A=!0),N.selection=X=[[n=t===m?Y:W[0],a=t===y?F:W[1]],[v=t===m?H:n,k=t===y?J:a]]):(n=X[0][0],a=X[0][1],v=X[1][0],k=X[1][1]),i=n,u=a,b=v,z=k;var tt=e.select(S).attr("pointer-events","none"),et=tt.selectAll(".overlay").attr("cursor",w[j]);if(e.event.touches)$.moved=rt,$.ended=st;else{var nt=e.select(e.event.view).on("mousemove.brush",rt,!0).on("mouseup.brush",st,!0);P&&nt.on("keydown.brush",function(){switch(e.event.keyCode){case 16:R=I&&G;break;case 18:D===f&&(I&&(v=b-L*I,n=i+L*I),G&&(k=z-Q*G,a=u+Q*G),D=d,it());break;case 32:D!==f&&D!==d||(I<0?v=b-L:I>0&&(n=i-L),G<0?k=z-Q:G>0&&(a=u-Q),D=h,et.attr("cursor",w.selection),it());break;default:return}l()},!0).on("keyup.brush",function(){switch(e.event.keyCode){case 16:R&&(q=T=R=!1,it());break;case 18:D===d&&(I<0?v=b:I>0&&(n=i),G<0?k=z:G>0&&(a=u),D=f,it());break;case 32:D===h&&(e.event.altKey?(I&&(v=b-L*I,n=i+L*I),G&&(k=z-Q*G,a=u+Q*G),D=d):(I<0?v=b:I>0&&(n=i),G<0?k=z:G>0&&(a=u),D=f),et.attr("cursor",w[j]),it());break;default:return}l()},!0),r.dragDisable(e.event.view)}o(),s.interrupt(S),B.call(S),$.start()}function rt(){var t=U(S);!R||q||T||(Math.abs(t[0]-Z[0])>Math.abs(t[1]-Z[1])?T=!0:q=!0),Z=t,A=!0,l(),it()}function it(){var t;switch(L=Z[0]-W[0],Q=Z[1]-W[1],D){case h:case c:I&&(L=Math.max(Y-n,Math.min(H-v,L)),i=n+L,b=v+L),G&&(Q=Math.max(F-a,Math.min(J-k,Q)),u=a+Q,z=k+Q);break;case f:I<0?(L=Math.max(Y-n,Math.min(H-n,L)),i=n+L,b=v):I>0&&(L=Math.max(Y-v,Math.min(H-v,L)),i=n,b=v+L),G<0?(Q=Math.max(F-a,Math.min(J-a,Q)),u=a+Q,z=k):G>0&&(Q=Math.max(F-k,Math.min(J-k,Q)),u=a,z=k+Q);break;case d:I&&(i=Math.max(Y,Math.min(H,n-L*I)),b=Math.max(Y,Math.min(H,v+L*I))),G&&(u=Math.max(F,Math.min(J,a-Q*G)),z=Math.max(F,Math.min(J,k+Q*G)))}b<i&&(I*=-1,t=n,n=v,v=t,t=i,i=b,b=t,j in g&&et.attr("cursor",w[j=g[j]])),z<u&&(G*=-1,t=a,a=k,k=t,t=u,u=z,z=t,j in x&&et.attr("cursor",w[j=x[j]])),N.selection&&(X=N.selection),q&&(i=X[0][0],b=X[1][0]),T&&(u=X[0][1],z=X[1][1]),X[0][0]===i&&X[0][1]===u&&X[1][0]===b&&X[1][1]===z||(N.selection=[[i,u],[b,z]],B.call(S),$.brush())}function st(){if(o(),e.event.touches){if(e.event.touches.length)return;p&&clearTimeout(p),p=setTimeout(function(){p=null},500)}else r.dragEnable(e.event.view,A),nt.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);var t;tt.attr("pointer-events","all"),et.attr("cursor",w.overlay),N.selection&&(X=N.selection),((t=X)[0][0]===t[1][0]||t[0][1]===t[1][1])&&(N.selection=null,B.call(S)),$.end()}}function G(){C(this,arguments).moved()}function N(){C(this,arguments).ended()}function O(){var e=this.__brush||{selection:null};return e.extent=v(b.apply(this,arguments)),e.dim=t,e}return j.start=function(t,n){t.each(function(){e.customEvent(n,I,this,[void 0,0,[this]])})},j.move=function(e,n){e.selection?e.on("start.brush",function(){C(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){C(this,arguments).end()}).tween("brush",function(){var e=this,r=e.__brush,s=C(e,arguments),a=r.selection,u=t.input("function"==typeof n?n.apply(this,arguments):n,r.extent),o=i.interpolate(a,u);function l(t){r.selection=1===t&&null===u?null:o(t),B.call(e),s.brush()}return null!==a&&null!==u?l:l(1)}):e.each(function(){var e=arguments,r=this.__brush,i=t.input("function"==typeof n?n.apply(this,e):n,r.extent),a=C(this,e).beforestart();s.interrupt(this),r.selection=null===i?null:i,B.call(this),a.start().brush().end()})},j.clear=function(t){j.move(t,null)},D.prototype={beforestart:function(){return 1==++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting?(this.starting=!1,this.emit("start")):this.emit("brush"),this},brush:function(){return this.emit("brush"),this},end:function(){return 0==--this.active&&(delete this.state.emitter,this.emit("end")),this},emit:function(n){e.customEvent(new u(j,n,t.output(this.state.selection)),V.apply,V,[n,this.that,this.args])}},j.extent=function(t){return arguments.length?(b="function"==typeof t?t:a(v(t)),j):b},j.filter=function(t){return arguments.length?(K="function"==typeof t?t:a(!!t),j):K},j.touchable=function(t){return arguments.length?(T="function"==typeof t?t:a(!!t),j):T},j.handleSize=function(t){return arguments.length?(S=+t,j):S},j.keyModifiers=function(t){return arguments.length?(P=!!t,j):P},j.on=function(){var t=V.on.apply(V,arguments);return t===V?j:t},j}t.brush=function(){return K(b)},t.brushX=function(){return K(y)},t.brushY=function(){return K(m)},t.brushSelection=function(t){var e=t.__brush;return e?e.dim.output(e.selection):null},Object.defineProperty(t,"__esModule",{value:!0})});
